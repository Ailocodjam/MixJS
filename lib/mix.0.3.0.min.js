/*! mix 0.3.0 2013-04-24 by Theowang */
(function(t,e,n){"use strict";function i(e,i,r,s){if(0===arguments.length)throw Error("Module: I need a agrument");H.isFunction(e)?(r=e,e=n,i=v):H.isArray(e)?(i=v,e=n):H.isFunction(i)&&(r=i,i=v),this.id=e?f(e)[2]:e,this.status="uninitialized",H.isString(i)&&(i=i.split(",")),this.dependencies=i,this.factory=r,this.root=s||t,this.undef=[],this.id&&(T[this.id]="uninitialized"),this.checkDependencies(i),this.define()}function r(t){return"THEO"===t.amd}function s(t){return"defined"===T[t]}function o(){this.status="unfulfilled",this.fulfilledHandlers=[],this.errorHandlers=[],this.progressHandlers=[],this.reason=""}function u(t){return t instanceof o}function a(t){for(var e in t)t.hasOwnProperty(e)&&t[e]&&(H.isArray(t[e])&&(t[e].length=0),H.isFunction(t[e].destroy)&&t[e].destroy(),delete t[e])}function f(t,e){var n,i,r,s,o=M.alias;if(e=e||J.baseURL,e=e.substr(0,e.lastIndexOf("/")),s=t,j.test(t)&&o[t])n=o[t];else if(/^(\w+)(\d)?:.*/.test(t))n=t;else if(i=t.charAt(0),r=t.slice(0,2),"."!==i&&"/"!==i)n=e+"/"+t;else if("./"===r)s=t.substr(2),n=e+"/"+s;else if(".."===r){var u=e.split("/");i=t.replace(/\.\.\//g,function(){return u.pop(),""}),s=i,n=u.join("/")+"/"+i}var a="js";return i=n.replace(/[?#].*/,""),/\.(\w+)$/.test(i)&&(a=RegExp.$1),"css"===a||i!==n||A.test(n)||(n+=".js"),[n,a,s]}function c(t){t.onload=t.onerror=t.onreadystatechange=null,t.parentNode&&p(function(){t.parentNode.removeChild(t),t=null},0)}function l(t,e){return m.toString.call(t).slice(8,-1)===e}function d(t,e,n){var i,r=S.call(arguments),s=1;for(n=H.isBoolean(n)?n:!0;e=r[s++];)if(H.isArray(e))for(var o=0,u=e.length;u>o;o++)d(t,e[o],n);else for(i in e)!n&&i in t||(t[i]=e[i]);return t}function h(t,e){var i=!1;if(C++,C>200)return e(),i=!0,n;if(k)t.sheet&&(i=!0);else if(t.sheet)try{t.sheet.cssRules&&(i=!0)}catch(r){"NS_ERROR_DOM_SECURITY_ERR"===r.name&&(i=!0)}p(function(){i?e():h(t,e)},50)}var p=t.setTimeout,g=function(){},m={},v=[],y=e.head||e.getElementsByTagName("head")[0]||e.documentElement,b=y.getElementsByTagName("base")[0]||null,S=v.slice,F=function(){var t=e.getElementsByTagName("script");return t[t.length-1]}(),O=function(t){var e=t.hasAttribute?t.src:t.getAttribute("src",4);return e.substr(0,e.lastIndexOf("/"))+"/"}(F),E=navigator.userAgent,A=/\.js$/i,x=/\.css$/i,j=/^[-\w\d_$]{2,}$/i,w="MixJS 0.3 butterfly",H={},R={},N={},k=536>Number(E.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")),B=~E.indexOf("Firefox")&&!("onload"in e.createElement("link")),D=k||B?function(t,e){H.isFunction(e)&&(C=0,p(function(){h(t,e)},50))}:function(t,e,n){H.isFunction(e)&&(t.onload=function(){e()}),H.isFunction(n)&&(t.onerror=function(){n()})};"Function,String,Array,Number".replace(/[^, ]+/g,function(t){H["is"+t]=function(e){return l(e,t)}}),H.isFunction=function(t){return"function"==typeof t},H.isObject=function(t){return"object"==typeof t},H.isBoolean=function(t){return t===!0||t===!1||l(t,"Boolean")},H.isUndefined=function(t){return t===n};var J={timeout:2e4,baseURL:O,charset:"utf-8"},M={version:w,mix:d,indexOf:function(t,e,n){if(null==t)return-1;var i=0,r=t.length;if(n&&(i=0>n?Math.max(0,r+n):n),v.indexOf&&t.indexOf===v.indexOf)return t.indexOf(e,n);for(;r>i;i++)if(t[i]===e)return i;return-1},each:v.forEach?function(t,e,n){v.forEach.call(t,e,n)}:function(t,e,n){for(var i=0,r=t.length;r>i;i++)i in t&&e.call(n,t[i],i,t)},defined:s,define:function(t,e,n){return new i(t,e,n),this},use:function(t,e){return new i(n,t,e),this},config:function(t){return H.isObject(t)?(d(J,t),this):J},loaded:function(t){return t=f(t)[0],"loaded"===M.status(t)},status:function(t){return N[t]},alias:function(t,e){if(j.test(t)){if(H.isUndefined(e))return R[t];R[t]=(e+"").split(",")}else H.isObject(t)&&(e=t.path,t=t,M.alias(t,e))},loadJS:function(t,n,i,r,s,o){if(H.isObject(t))return n=t.callback,i=t.attrs,r=t.timeout,s=t.fail,o=t.complete,t=t.src,M.loadJS(t,n,i,r,s,o);var u=e.createElement("script"),a=!1;if(H.isObject(i))for(var l in i)u.setAttribute(l,i[l]);var d=f(t);return t=u.src=d[0],u.async=!0,u.charset=J.charset,o=H.isFunction(o)?o:g,u.onload=u.onreadystatechange=function(e){e=e||m,a||"load"!==e.type&&!/loaded|complete|undefined/.test(u.readyState)||(a=!0,c(u),N[t]="loaded",H.isFunction(n)&&n(),o("load"))},u.onerror=function(){a=!0,N[t]="error",H.isFunction(s)&&s(),o("error")},r=H.isNumber(r)?r:J.timeout,r&&p(function(){a||(a=!0,N[t]="timeout",o("timeout"))},r),N[t]="pending",y.insertBefore(u,b),this},loadCSS:function(t,n,i,r,s,o){if(H.isObject(t))return n=t.callback,i=t.attrs,r=t.timeout,s=t.fail,o=t.complete,t=t.href,M.loadCSS(t,n,i,r,s,o);var u=e.createElement("link"),a=!1;r=H.isNumber(r)?r:J.timeout;var c=f(t);if(t=u.href=c[0],u.rel="stylesheet",u.type="text/css",o=H.isFunction(o)?o:g,H.isObject(i))for(var l in i)u.setAttribute(l,i[l]);var d=function(){a||(a=!0,u.onload=u.onerror=u.onreadystatechange=null,N[t]="loaded",H.isFunction(n)&&n(),o("load"))},h=function(){a=!0,u.onload=u.onerror=u.onreadystatechange=null,N[t]="error",H.isFunction(s)&&s(),o("error")};return D(u,d,h),r&&p(function(){a||(a=!0,N[t]="timeout",o("timeout"))},r),N[t]="pending",y.insertBefore(u,b),this},Promise:o,isAMD:r},T={},$={};i.prototype={constructor:i,define:function(){this.canDefine()?this.namespace():"pending"!==this.status&&(this.status="pending",this.id&&(T[this.id]=this.status),this.loadDeps())},namespace:function(){for(var t,e,n=H.isString(this.id)?this.id.split("/"):v,i=this.root;t=n.shift();)e=t,n.length&&(i=i[t]);try{var r=H.isFunction(this.factory)&&this.factory.apply(this.root,this.getArgs());r&&(r.amd="THEO",i[e]=r,this.id&&(T[this.id]="defined"))}catch(s){throw this.id&&(T[this.id]="error"),Error("Module.namespace error:id=>"+this.id+";undef=>"+this.undef.join(",")+";info=>"+s.message)}this.id&&H.isArray($[this.id])&&M.each($[this.id],function(t){u(t)&&t.resolve()}),this.destroy()},getFn:function(t){t=t.split("/");for(var e,n=this.root;e=t.shift();)n=n[e];return n},getArgs:function(){for(var t,e=this.dependencies,n=[],i=0,r=e.length;r>i;i++)t=e[i],n.push(this.getFn(t));return n},canDefine:function(){for(var t,e=this.undef,n=e.length;n--;)if(t=e[n],!s(t)){if((x.test(t)||A.test(t))&&M.loaded(t))continue;return!1}return!0},loadDeps:function(){var t,e=this,n=e.undef;M.each(n,function(n){if(t=new o,$[n]=$[n]?$[n]:[],$[n].push(t.done(function(){e.define()})),"pending"!==T[n]){var i=M.alias(n);if(i&&i.length){var r=new o;r.done(function(){e.define()});var s=i.length,u=function(){s--,0===s&&(T[n]="defined",r.resolve())};M.each(i,function(t){if(x.test(t))M.loadCSS(t,u);else if(A.test(t))M.loadJS(t,u);else{var e=new o;$[t]=$[t]?$[t]:[],$[t].push(e.done(u)),M.loadJS(t)}})}else x.test(n)?M.loadCSS(n,function(){e.define()}):A.test(n)?M.loadJS(n,function(){e.define()}):M.loadJS(n)}})},checkDependencies:function(t){var e=this;M.each(t,function(t){t=f(t)[2],s(t)||e.undef.push(t)})},destroy:function(){a(this)}},o.prototype={constructor:o,reject:function(t){return"unfulfilled"!==this.status?this:(this.reason=t,this.status="failed",this.fire(this.errorHandlers,t))},isResolved:function(){return"fulfilled"===this.status},resolve:function(t){return"unfulfilled"!==this.status?this:(this.reason=t,this.status="fulfilled",this.fire(this.fulfilledHandlers,t))},fail:function(t){return this.then(n,t)},complete:function(t){return this.then(n,n,t)},then:function(t,e,n){switch(this.status){case"unfulfilled":this.add(t,"fulfilled"),this.add(e,"error"),this.add(n,"progress");break;case"fulfilled":this.fire(t,this.reason),this.fire(n,this.reason);break;case"failed":this.fire(e,this.reason),this.fire(n,this.reason)}return this},done:function(t){return this.then(t)},fire:function(t,e){if(H.isArray(t)){for(var n;n=t.shift();)H.isFunction(n)&&n(e);this.clear()}else H.isFunction(t)&&t(e);return this},add:function(t,e){return e+="Handlers",H.isFunction(t)&&this[e]&&this[e].push(t),this},clear:function(){this.fulfilledHandlers.length=0,this.errorHandlers.length=0,this.progressHandlers.length=0}};var C=0;H.isUndefined(t.define)&&(t.define=M.define),t.MixJS=d(M,H)})(window,document);