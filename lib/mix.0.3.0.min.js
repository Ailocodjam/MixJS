/*! mix 0.3.0 2013-04-25 by Theowang */
(function(t,e,n){"use strict";function i(e,i,r,s){if(0===arguments.length)throw Error("Module: I need a agrument");R.isFunction(e)?(r=e,e=n,i=v):R.isArray(e)?(i=v,e=n):R.isFunction(i)&&(r=i,i=v),this.id=e?f(e)[2]:e,this.status="uninitialized",R.isString(i)&&(i=i.split(",")),this.dependencies=i,this.factory=r,this.root=s||t,this.undef=[],this.id&&($[this.id]="uninitialized"),this.checkDependencies(i),this.define()}function r(t){return"THEO"===t.amd}function s(t){return"defined"===$[t]}function o(){this.status="unfulfilled",this.fulfilledHandlers=[],this.errorHandlers=[],this.reason=""}function u(t){return t instanceof o}function a(t){for(var e in t)t.hasOwnProperty(e)&&t[e]&&(R.isArray(t[e])&&(t[e].length=0),R.isFunction(t[e].destroy)&&t[e].destroy(),delete t[e])}function f(t,e){var n,i,r,s,o=T.alias;if(e=e||M.baseURL,e=e.substr(0,e.lastIndexOf("/")),s=t,j.test(t)&&o[t])n=o[t];else if(/^(\w+)(\d)?:.*/.test(t))n=t;else if(i=t.charAt(0),r=t.slice(0,2),"."!==i&&"/"!==i)n=e+"/"+t;else if("./"===r)s=t.substr(2),n=e+"/"+s;else if(".."===r){var u=e.split("/");i=t.replace(/\.\.\//g,function(){return u.pop(),""}),s=i,n=u.join("/")+"/"+i}var a="js";return i=n.replace(/[?#].*/,""),/\.(\w+)$/.test(i)&&(a=RegExp.$1),"css"===a||i!==n||x.test(n)||(n+=".js"),[n,a,s]}function c(t){t.onload=t.onerror=t.onreadystatechange=null,t.parentNode&&p(function(){t.parentNode.removeChild(t),t=null},0)}function l(t,e){return m.toString.call(t).slice(8,-1)===e}function d(t,e,n){var i,r=S.call(arguments),s=1;for(n=R.isBoolean(n)?n:!0;e=r[s++];)if(R.isArray(e))for(var o=0,u=e.length;u>o;o++)d(t,e[o],n);else for(i in e)!n&&i in t||(t[i]=e[i]);return t}function h(t,e){var i=!1,r=k[t.href]++;if(r>300)return e(),i=!0,n;if(B)t.sheet&&(i=!0);else if(t.sheet)try{t.sheet.cssRules&&(i=!0)}catch(s){"NS_ERROR_DOM_SECURITY_ERR"===s.name&&(i=!0)}p(function(){i?e():h(t,e)},50)}var p=t.setTimeout,g=function(){},m={},v=[],y=e.head||e.getElementsByTagName("head")[0]||e.documentElement,b=y.getElementsByTagName("base")[0]||null,S=v.slice,F=function(){var t=e.getElementsByTagName("script");return t[t.length-1]}(),O=function(t){var e=t.hasAttribute?t.src:t.getAttribute("src",4);return e.substr(0,e.lastIndexOf("/"))+"/"}(F),E=navigator.userAgent,x=/\.js$/i,A=/\.css$/i,j=/^[-\w\d_$]{2,}$/i,w="MixJS 0.3 butterfly",R={},N={},H={},k={},B=536>Number(E.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")),D=~E.indexOf("Firefox")&&!("onload"in e.createElement("link")),J=B||D?function(t,e){R.isFunction(e)&&(k[t.href]=0,p(function(){h(t,e)},50))}:function(t,e,n){R.isFunction(e)&&(t.onload=function(){e()}),R.isFunction(n)&&(t.onerror=function(){n()})};"Function,String,Array,Number".replace(/[^, ]+/g,function(t){R["is"+t]=function(e){return l(e,t)}}),R.isFunction=function(t){return"function"==typeof t},R.isObject=function(t){return"object"==typeof t},R.isBoolean=function(t){return t===!0||t===!1||l(t,"Boolean")},R.isUndefined=function(t){return t===n};var M={timeout:2e4,baseURL:O,charset:"utf-8"},T={version:w,mix:d,indexOf:function(t,e,n){if(null==t)return-1;var i=0,r=t.length;if(n&&(i=0>n?Math.max(0,r+n):n),v.indexOf&&t.indexOf===v.indexOf)return t.indexOf(e,n);for(;r>i;i++)if(t[i]===e)return i;return-1},each:v.forEach?function(t,e,n){v.forEach.call(t,e,n)}:function(t,e,n){for(var i=0,r=t.length;r>i;i++)i in t&&e.call(n,t[i],i,t)},defined:s,define:function(t,e,n){return new i(t,e,n),this},use:function(t,e){return new i(n,t,e),this},config:function(t){return R.isObject(t)?(d(M,t),this):M},loaded:function(t){return t=f(t)[0],"loaded"===T.status(t)},status:function(t){return H[t]},alias:function(t,e){if(j.test(t)){if(R.isUndefined(e))return N[t];N[t]=(e+"").split(",")}else R.isObject(t)&&(e=t.path,t=t,T.alias(t,e))},loadJS:function(t,n,i,r,s,o){if(R.isObject(t))return n=t.callback,i=t.attrs,r=t.timeout,s=t.fail,o=t.complete,t=t.src,T.loadJS(t,n,i,r,s,o);var u=e.createElement("script"),a=!1;if(R.isObject(i))for(var l in i)u.setAttribute(l,i[l]);var d=f(t);return t=u.src=d[0],u.async=!0,u.type="text/javascript",u.charset=M.charset,o=R.isFunction(o)?o:g,u.onload=u.onreadystatechange=function(e){e=e||m,a||"load"!==e.type&&!/loaded|complete|undefined/.test(u.readyState)||(a=!0,c(u),H[t]="loaded",R.isFunction(n)&&n(),o("load"))},u.onerror=function(){a=!0,H[t]="error",R.isFunction(s)&&s(),o("error")},r=R.isNumber(r)?r:M.timeout,r&&p(function(){a||(a=!0,H[t]="timeout",o("timeout"))},r),H[t]="pending",y.insertBefore(u,b),this},loadCSS:function(t,n,i,r,s,o){if(R.isObject(t))return n=t.callback,i=t.attrs,r=t.timeout,s=t.fail,o=t.complete,t=t.href,T.loadCSS(t,n,i,r,s,o);var u=e.createElement("link"),a=!1;r=R.isNumber(r)?r:M.timeout;var c=f(t);if(t=u.href=c[0],u.rel="stylesheet",u.type="text/css",o=R.isFunction(o)?o:g,R.isObject(i))for(var l in i)u.setAttribute(l,i[l]);var d=function(){a||(a=!0,u.onload=u.onerror=u.onreadystatechange=null,H[t]="loaded",R.isFunction(n)&&n(),o("load"))},h=function(){a=!0,u.onload=u.onerror=u.onreadystatechange=null,H[t]="error",R.isFunction(s)&&s(),o("error")};return J(u,d,h),r&&p(function(){a||(a=!0,H[t]="timeout",o("timeout"))},r),H[t]="pending",y.insertBefore(u,b),this},Promise:o,isAMD:r},$={},C={};i.prototype={constructor:i,define:function(){this.canDefine()?this.namespace():"pending"!==this.status&&(this.status="pending",this.id&&($[this.id]=this.status),this.loadDeps())},namespace:function(){for(var t,e,n=R.isString(this.id)?this.id.split("/"):v,i=this.root;t=n.shift();)e=t,n.length&&(i=i[t]);try{var r=R.isFunction(this.factory)&&this.factory.apply(this.root,this.getArgs());r&&(r.amd="THEO",i[e]=r,this.id&&($[this.id]="defined"))}catch(s){throw this.id&&($[this.id]="error"),Error("Module.namespace error:id=>"+this.id+";undef=>"+this.undef.join(",")+";info=>"+s.message)}this.id&&R.isArray(C[this.id])&&T.each(C[this.id],function(t){u(t)&&t.resolve()}),this.destroy()},getFn:function(t){t=t.split("/");for(var e,n=this.root;e=t.shift();)n=n[e];return n},getArgs:function(){for(var t,e=this.dependencies,n=[],i=0,r=e.length;r>i;i++)t=e[i],n.push(this.getFn(t));return n},canDefine:function(){for(var t,e=this.undef,n=e.length;n--;)if(t=e[n],!s(t)){if((A.test(t)||x.test(t))&&T.loaded(t))continue;return!1}return!0},loadDeps:function(){var t,e=this,n=e.undef;T.each(n,function(n){if(t=new o,C[n]=C[n]?C[n]:[],C[n].push(t.done(function(){e.define()})),"pending"!==$[n]){var i=T.alias(n);if(i&&i.length){var r=new o;r.done(function(){e.define()});var s=i.length,u=function(){s--,0===s&&($[n]="defined",r.resolve())};T.each(i,function(t){if(A.test(t))T.loadCSS(t,u);else if(x.test(t))T.loadJS(t,u);else{var e=new o;C[t]=C[t]?C[t]:[],C[t].push(e.done(u)),T.loadJS(t)}})}else A.test(n)?T.loadCSS(n,function(){e.define()}):x.test(n)?T.loadJS(n,function(){e.define()}):T.loadJS(n)}})},checkDependencies:function(t){var e=this;T.each(t,function(t){t=f(t)[2],s(t)||e.undef.push(t)})},destroy:function(){a(this)}},o.prototype={constructor:o,reject:function(t){return"unfulfilled"!==this.status?this:(this.reason=t,this.status="failed",this.fire(this.errorHandlers,t))},isResolved:function(){return"fulfilled"===this.status},resolve:function(t){return"unfulfilled"!==this.status?this:(this.reason=t,this.status="fulfilled",this.fire(this.fulfilledHandlers,t))},fail:function(t){return this.then(n,t)},always:function(t){return this.then(t,t)},then:function(t,e){switch(this.status){case"unfulfilled":this.add(t,"fulfilled").add(e,"error");break;case"fulfilled":this.fire(t,this.reason);break;case"failed":this.fire(e,this.reason)}return this},done:function(t){return this.then(t)},fire:function(t,e){if(R.isArray(t)){for(var n;n=t.shift();)R.isFunction(n)&&n(e);this.clear()}else R.isFunction(t)&&t(e);return this},add:function(t,e){return e+="Handlers",R.isFunction(t)&&this[e]&&this[e].push(t),this},clear:function(){this.fulfilledHandlers.length=0,this.errorHandlers.length=0}},R.isUndefined(t.define)&&(t.define=T.define),t.MixJS=d(T,R)})(window,document);